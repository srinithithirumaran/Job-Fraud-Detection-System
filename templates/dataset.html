{% extends 'base.html' %}
{% block content %}
<h2 class="mb-3">Dataset Overview</h2>
<div class="row g-3 mb-4">
    <div class="col-md-3">
        <div class="card text-center shadow-sm">
            <div class="card-body">
                <div class="text-muted">Total Jobs</div>
                <div class="display-6 fw-bold">{{ dataset_stats.total_jobs }}</div>
            </div>
        </div>
    </div>
    <div class="col-md-3">
        <div class="card text-center shadow-sm">
            <div class="card-body">
                <div class="text-muted">Real Jobs</div>
                <div class="display-6 fw-bold text-success">{{ dataset_stats.real_jobs }}</div>
            </div>
        </div>
    </div>
    <div class="col-md-3">
        <div class="card text-center shadow-sm">
            <div class="card-body">
                <div class="text-muted">Fake Jobs</div>
                <div class="display-6 fw-bold text-danger">{{ dataset_stats.fake_jobs }}</div>
            </div>
        </div>
    </div>
    <div class="col-md-3">
        <div class="card text-center shadow-sm">
            <div class="card-body">
                <div class="text-muted">Datasets Combined</div>
                <div class="display-6 fw-bold">{{ dataset_stats.combined_datasets|length }}</div>
            </div>
        </div>
    </div>
</div>
<div class="row g-3 mb-4">
    <div class="col-md-6">
        <div class="card shadow-sm h-100">
            <div class="card-header bg-info text-white">
                <h5 class="mb-0">ðŸ“Š Job Distribution</h5>
            </div>
            <div class="card-body text-center">
                <canvas id="jobDistChart" style="max-height: 300px;"></canvas>
            </div>
        </div>
    </div>
    <div class="col-md-6">
        <div class="card shadow-sm h-100">
            <div class="card-header bg-info text-white">
                <h5 class="mb-0">ðŸ“ˆ Statistics</h5>
            </div>
            <div class="card-body">
                <div class="mb-3">
                    <div class="d-flex justify-content-between">
                        <span>Real Jobs:</span>
                        <strong class="text-success">{{ dataset_stats.real_percentage }}%</strong>
                    </div>
                    <div class="progress" style="height: 25px;">
                        <div class="progress-bar bg-success" role="progressbar" style="width: {{ dataset_stats.real_percentage }}%">{{ dataset_stats.real_jobs }}</div>
                    </div>
                </div>
                <div>
                    <div class="d-flex justify-content-between">
                        <span>Fake Jobs:</span>
                        <strong class="text-danger">{{ dataset_stats.fraud_percentage }}%</strong>
                    </div>
                    <div class="progress" style="height: 25px;">
                        <div class="progress-bar bg-danger" role="progressbar" style="width: {{ dataset_stats.fraud_percentage }}%">{{ dataset_stats.fake_jobs }}</div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
<div class="row g-3">
    <div class="col-md-6">
        <div class="card shadow-sm h-100">
            <div class="card-header">Combined datasets</div>
            <div class="card-body">
                <ul class="mb-0">
                    {% for name in dataset_stats.combined_datasets %}
                        <li>{{ name }}</li>
                    {% endfor %}
                </ul>
            </div>
        </div>
    </div>
    <div class="col-md-6">
        <div class="card shadow-sm h-100">
            <div class="card-header">Existing dataset variants</div>
            <div class="card-body">
                <ul class="mb-0">
                    {% for name in dataset_stats.existing_datasets %}
                        <li>{{ name }}</li>
                    {% endfor %}
                </ul>
            </div>
        </div>
    </div>
</div>
<div class="row g-3 mt-3">
    <div class="col-md-12">
        <div class="card shadow-sm">
            <div class="card-header">Dataset statistics</div>
            <div class="card-body">
                <div class="d-flex flex-wrap gap-4">
                    <div><strong>Average words:</strong> {{ dataset_stats.summary.avg_words }}</div>
                    <div><strong>Median title length:</strong> {{ dataset_stats.summary.median_title_length }}</div>
                    <div><strong>Missing rate:</strong> {{ dataset_stats.summary.missing_rate }}</div>
                </div>
                <p class="text-muted mt-2 mb-0">Replace these placeholders with computed stats from your data ingestion step.</p>
            </div>
        </div>
    </div>
</div>
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<script>
const ctx = document.getElementById('jobDistChart');
new Chart(ctx, {
    type: 'pie',
    data: {
        labels: ['Real Jobs ({{ dataset_stats.real_percentage }}%)', 'Fake Jobs ({{ dataset_stats.fraud_percentage }}%)'],
        datasets: [{
            data: [{{ dataset_stats.real_jobs }}, {{ dataset_stats.fake_jobs }}],
            backgroundColor: ['#28a745', '#dc3545'],
            borderWidth: 2
        }]
    },
    options: {
        responsive: true,
        maintainAspectRatio: true,
        plugins: {
            legend: {
                position: 'bottom'
            },
            title: {
                display: true,
                text: 'Real vs Fake Job Postings',
                font: { size: 16 }
            }
        }
    }
});
</script>
{% endblock %}
